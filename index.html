<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Select a Company</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
    }
    h2 {
      font-size: 40px;
      color: #1a73e8;
      border-bottom: 3px solid #1a73e8;
      display: inline-block;
      padding: 10px;
    }
    select, input[type="file"], button {
      margin: 10px;
      padding: 8px;
      font-size: 14px;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 90%;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
    }
    th {
      background-color: #f2f2f2;
      text-transform: capitalize;
      opacity: 0.9;
    }
    #footer {
      margin-top: 40px;
      color: gray;
      font-size: 13px;
    }
    .button-link {
      background: none;
      border: 1px solid #1a73e8;
      border-radius: 15px;
      padding: 4px 12px;
      cursor: pointer;
      color: #1a73e8;
    }
  </style>
</head>
<body>

  <h2>Select a Company</h2>

  <div>
    <input type="file" id="fileInput" accept=".ndjson">
    <select id="companyDropdown">
      <option>Select a company</option>
    </select>
    <button onclick="sortByDate()" class="button-link">Sort by Date</button>
  </div>

  <p style="font-size: 12px; color: grey;">
    Recent questions extracted from the LeetCode interview discussions till 14th April.<br>
    Filter by company to view structured details and sort by date.
  </p>

  <div id="tableContainer"></div>

  <div id="footer">
    Created by - Sandesh Malleboina | 
    <a href="https://www.linkedin.com/in/sandesh-malleboina/" target="_blank">LinkedIn</a>
  </div>

  <script>
    let allData = [];

    document.getElementById('fileInput').addEventListener('change', function(e) {
      const reader = new FileReader();
      reader.onload = function() {
        const lines = reader.result.split('\n').filter(Boolean);
        allData = lines.flatMap(line => JSON.parse(line));
        populateDropdown(allData);
      };
      reader.readAsText(e.target.files[0]);
    });

    function populateDropdown(data) {
      const dropdown = document.getElementById('companyDropdown');
      const companies = [...new Set(data.map(d => d.company))];
      dropdown.innerHTML = '<option>Select a company</option>';
      companies.forEach(company => {
        const option = document.createElement('option');
        option.value = company;
        option.textContent = company;
        dropdown.appendChild(option);
      });

      dropdown.addEventListener('change', function () {
        const selected = this.value;
        if (selected !== 'Select a company') {
          const filtered = allData.filter(d => d.company === selected);
          showTable(filtered);
        }
      });
    }

    function showTable(data) {
      let html = `<table><thead><tr>
        <th>#</th>
        <th>Company</th>
        <th>Role</th>
        <th>YOE</th>
        <th>Question</th>
        <th>Topic</th>
        <th>Round Type</th>
        <th>Difficulty</th>
        <th>Link</th>
        <th>Date</th>
      </tr></thead><tbody>`;

      data.forEach((item, idx) => {
        html += `<tr>
          <td>${idx + 1}</td>
          <td>${item.company}</td>
          <td>${item.role}</td>
          <td>${item.yoe}</td>
          <td>${item.quesion || item.question || 'NA'}</td>
          <td>${item.topic}</td>
          <td>${item.round_type?.replace('_', ' ')}</td>
          <td>${item.difficulty}</td>
          <td><a class="button-link" href="${item.url}" target="_blank">Post</a></td>
          <td>${item.date}</td>
        </tr>`;
      });

      html += '</tbody></table>';
      document.getElementById('tableContainer').innerHTML = html;
    }

    function sortByDate() {
      const dropdown = document.getElementById('companyDropdown');
      const selected = dropdown.value;
      if (selected !== 'Select a company') {
        const filtered = allData.filter(d => d.company === selected);
        const sorted = filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
        showTable(sorted);
      }
    }
  </script>

</body>
</html>
